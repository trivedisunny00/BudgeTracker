<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Personal Finance Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f6f7fb;--card:#ffffff;--muted:#6b7280;--accent:#00a8e8;--accent-2:#2e2e2e}
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:var(--accent-2);}
    .app{max-width:1200px;margin:18px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px}
    header h1{margin:0;font-size:20px}
    nav{margin-top:14px;display:flex;gap:8px}
    .tab{background:var(--card);padding:8px 12px;border-radius:8px;cursor:pointer;border:1px solid #e6e9ef}
    .tab.active{box-shadow:0 4px 18px rgba(0,0,0,0.06);border-color:rgba(0,0,0,0.05)}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:16px;margin-top:18px}
    .card{background:var(--card);padding:16px;border-radius:8px;box-shadow:0 2px 10px rgba(12,17,24,0.03)}
    .small{font-size:12px;color:var(--muted)}
    .kpi{display:flex;gap:8px;align-items:center}
    .kpi .tile{flex:1;padding:12px;border-radius:8px;background:linear-gradient(180deg,#fff, #fbfdff);border:1px solid #eef3f8}
    .kpi .tile h3{margin:0;font-size:14px}
    .kpi .tile p{margin:6px 0 0;font-size:18px;font-weight:600}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    select,input[type=date],input[type=text],input[type=number]{padding:8px;border-radius:6px;border:1px solid #e3e6ee}
    .form-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px dashed #efefef;text-align:left;font-size:13px}
    th{background:#fafafa}
    .right{text-align:right}
    .muted{color:var(--muted)}
    .btn{padding:8px 10px;border-radius:6px;border:0;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid #e6e9ef}
    .charts{height:260px}
    .section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    @media (max-width:980px){.grid{grid-template-columns:1fr;}.kpi{flex-direction:column}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <img src="" alt="" style="width:40px;height:40px;border-radius:8px;background:linear-gradient(90deg,#00a8e8,#2e2e2e)">
      <div>
        <h1>Personal Finance — Dashboard</h1>
        <div class="small">Income • Expense • Savings • Investments • Goals</div>
      </div>
    </header>

    <nav id="tabs">
      <div class="tab active" data-tab="dashboard">Dashboard</div>
      <div class="tab" data-tab="transactions">Transactions</div>
      <div class="tab" data-tab="investments">Investments</div>
      <div class="tab" data-tab="goals">Goals</div>
      <div class="tab" data-tab="settings">Settings</div>
    </nav>

    <!-- Main grid -->
    <div class="grid">
      <div>
        <!-- Dashboard -->
        <div id="dashboard" class="card view">
          <div class="section-title"><h3>Monthly Summary</h3>
            <div class="controls">
              <select id="yearSelect"></select>
              <select id="monthSelect"></select>
            </div>
          </div>

          <div class="kpi">
            <div class="tile">
              <h3>Total Income</h3>
              <p id="totalIncome">0</p>
            </div>
            <div class="tile">
              <h3>Total Expense</h3>
              <p id="totalExpense">0</p>
            </div>
            <div class="tile">
              <h3>Net Savings</h3>
              <p id="netSavings">0</p>
            </div>
            <div class="tile">
              <h3>Investments</h3>
              <p id="totalInvest">0</p>
            </div>
          </div>

          <div style="display:flex;gap:12px;margin-top:14px;">
            <div style="flex:1">
              <div class="card" style="padding:12px">
                <div class="section-title"><strong>Fund Breakdown</strong></div>
                <table>
                  <thead><tr><th>Fund</th><th class="right">Target</th><th class="right">Saved (YTD)</th><th class="right">Progress</th></tr></thead>
                  <tbody id="fundTable"></tbody>
                </table>
              </div>
            </div>

            <div style="width:320px">
              <div class="card">
                <div class="section-title"><strong>Quick Add</strong></div>
                <div class="form-row"><select id="quickType"><option value="expense">Expense</option><option value="income">Income</option><option value="saving">Saving</option></select></div>
                <div class="form-row"><input id="quickDate" type="date"/></div>
                <div class="form-row"><input id="quickDesc" type="text" placeholder="Description"/></div>
                <div class="form-row"><input id="quickAmount" type="number" placeholder="Amount"/></div>
                <div class="form-row"><button class="btn primary" id="quickAddBtn">Add</button><button class="btn ghost" id="resetData">Reset Data</button></div>
                <div class="small muted">Data is stored in your browser (localStorage). Use export in Settings to backup.</div>
              </div>
            </div>
          </div>

          <div style="margin-top:12px" class="card">
            <div class="section-title"><strong>Monthly Category Distribution</strong>
              <div class="small muted">(pie chart)</div>
            </div>
            <canvas id="categoryChart" class="charts"></canvas>
          </div>
        </div>

        <!-- Transactions -->
        <div id="transactions" class="card view" style="display:none">
          <div class="section-title"><h3>Daily Expense Tracker</h3>
            <div class="controls">
              <select id="transMonth"></select>
              <select id="transYear"></select>
            </div>
          </div>

          <div class="card" style="padding:10px;margin-bottom:12px">
            <div class="form-row"><input id="tDate" type="date"/><select id="tType"><option value="Expense">Expense</option><option value="Income">Income</option></select></div>
            <div class="form-row"><input id="tCategory" type="text" placeholder="Category (Food, Petrol, SIP...)"/></div>
            <div class="form-row"><input id="tDesc" type="text" placeholder="Description"/></div>
            <div class="form-row"><input id="tAmount" type="number" placeholder="Amount"/></div>
            <div class="form-row"><button class="btn primary" id="addTrans">Add Transaction</button></div>
          </div>

          <div class="card">
            <table>
              <thead><tr><th>Date</th><th>Type</th><th>Category</th><th>Description</th><th class="right">Amount</th></tr></thead>
              <tbody id="transTable"></tbody>
            </table>
          </div>
        </div>

        <!-- Investments -->
        <div id="investments" class="card view" style="display:none">
          <div class="section-title"><h3>Investments</h3>
            <div class="controls"><button class="btn primary" id="addInvestBtn">Add Investment</button></div>
          </div>
          <div class="card" id="investForm" style="display:none;padding:10px;margin-bottom:10px">
            <div class="form-row"><input id="invDate" type="date"/><input id="invType" type="text" placeholder="Type (Mutual Fund, Stock...)"/></div>
            <div class="form-row"><input id="invName" type="text" placeholder="Name"/><input id="invAmount" type="number" placeholder="Amount"/></div>
            <div class="form-row"><button class="btn primary" id="saveInvest">Save</button></div>
          </div>

          <div class="card">
            <table>
              <thead><tr><th>Date</th><th>Type</th><th>Name</th><th class="right">Amount</th></tr></thead>
              <tbody id="invTable"></tbody>
            </table>
          </div>
        </div>

        <!-- Goals -->
        <div id="goals" class="card view" style="display:none">
          <div class="section-title"><h3>Goal Tracker</h3><div class="controls"><button class="btn primary" id="addGoalBtn">Add Goal</button></div></div>
          <div class="card" id="goalForm" style="display:none;padding:10px;margin-bottom:10px">
            <div class="form-row"><input id="goalName" type="text" placeholder="Goal (Travel, Emergency...)"/><input id="goalTarget" type="number" placeholder="Target Amount"/></div>
            <div class="form-row"><input id="goalSaved" type="number" placeholder="Already Saved"/></div>
            <div class="form-row"><button class="btn primary" id="saveGoal">Save Goal</button></div>
          </div>

          <div class="card">
            <table>
              <thead><tr><th>Goal</th><th class="right">Target</th><th class="right">Saved</th><th class="right">Remaining</th><th class="right">Progress</th></tr></thead>
              <tbody id="goalTable"></tbody>
            </table>
          </div>
        </div>

        <!-- Settings -->
        <div id="settings" class="card view" style="display:none">
          <h3>Settings / Backup</h3>
          <div style="margin-top:8px"><button class="btn ghost" id="exportBtn">Export JSON</button> <button class="btn ghost" id="importBtn">Import JSON</button> <input type="file" id="importFile" style="display:none"/></div>
          <div style="margin-top:8px" class="small muted">You can export and import data as a JSON file to backup or transfer between devices.</div>
        </div>
      </div>

      <!-- Right column summary -->
      <aside>
        <div class="card">
          <h3>Year-to-Date</h3>
          <table>
            <tr><th>Total Income</th><td class="right" id="ytdIncome">0</td></tr>
            <tr><th>Total Expense</th><td class="right" id="ytdExpense">0</td></tr>
            <tr><th>Total Saving</th><td class="right" id="ytdSaving">0</td></tr>
            <tr><th>Total Investment</th><td class="right" id="ytdInvest">0</td></tr>
            <tr><th>Carry Forward</th><td class="right" id="carryForward">0</td></tr>
          </table>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Quick Chart</h3>
          <canvas id="miniChart" style="height:200px"></canvas>
        </div>
      </aside>
    </div>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    /* ---------- Data Layer (localStorage) ---------- */
    const STORAGE_KEY = 'pf-data-v1'
    function defaultData(){
      return { transactions: [], investments: [], goals: [
        {name:'Travel Fund',target:7000,saved:2300},
        {name:'Emergency Fund',target:50000,saved:4200},
        {name:'Future Fund',target:500000,saved:3000}
      ] }
    }

    function loadData(){
      const raw = localStorage.getItem(STORAGE_KEY)
      if(!raw) return defaultData()
      try{ return JSON.parse(raw)}catch(e){return defaultData()}
    }
    function saveData(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d))}

    let DATA = loadData()

    /* ---------- UI wiring ---------- */
    const tabs = document.querySelectorAll('.tab')
    tabs.forEach(t=>t.addEventListener('click',()=>{tabs.forEach(x=>x.classList.remove('active'));t.classList.add('active');showView(t.dataset.tab)}))
    function showView(name){document.querySelectorAll('.view').forEach(v=>v.style.display='none');document.getElementById(name).style.display='block';renderAll()}

    // populate month & year selects
    const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']
    function populateMonthYear(){
      const now = new Date();
      const ySel = document.getElementById('yearSelect');const mSel=document.getElementById('monthSelect');
      const y2 = document.getElementById('transYear');const m2=document.getElementById('transMonth')
      ySel.innerHTML = mSel.innerHTML = y2.innerHTML = m2.innerHTML = ''
      for(let y = now.getFullYear()-2; y<=now.getFullYear()+1; y++){[ySel,y2].forEach(sel=>sel.append(new Option(y,y)))}
      for(let i=0;i<12;i++){[mSel,m2].forEach(sel=>sel.append(new Option(monthNames[i],i+1)))}
      ySel.value = now.getFullYear(); mSel.value = now.getMonth()+1; y2.value = now.getFullYear(); m2.value = now.getMonth()+1
    }
    populateMonthYear()

    // Quick add
    document.getElementById('quickAddBtn').addEventListener('click',()=>{
      const type = document.getElementById('quickType').value
      const date = document.getElementById('quickDate').value || new Date().toISOString().slice(0,10)
      const desc = document.getElementById('quickDesc').value || type
      const amount = Number(document.getElementById('quickAmount').value)||0
      if(!amount) return alert('Enter amount')
      DATA.transactions.push({date,type: type==='expense'?'Expense':(type==='income'?'Income':'Saving'),category: type,description:desc,amount:amount})
      saveData(DATA); renderAll();
    })

    // Reset
    document.getElementById('resetData').addEventListener('click',()=>{
      if(!confirm('Reset all stored data?')) return; DATA = defaultData(); saveData(DATA); renderAll();
    })

    // Transactions
    document.getElementById('addTrans').addEventListener('click',()=>{
      const d=document.getElementById('tDate').value || new Date().toISOString().slice(0,10)
      const type=document.getElementById('tType').value
      const cat=document.getElementById('tCategory').value||'-'
      const desc=document.getElementById('tDesc').value||'-'
      const amt=Number(document.getElementById('tAmount').value)||0
      if(!amt) return alert('Enter amount')
      DATA.transactions.push({date:d,type,category:cat,description:desc,amount:amt})
      saveData(DATA); clearTransForm(); renderAll();
    })
    function clearTransForm(){['tDate','tCategory','tDesc','tAmount'].forEach(id=>document.getElementById(id).value='')}

    // Investments
    document.getElementById('addInvestBtn').addEventListener('click',()=>{document.getElementById('investForm').style.display='block'})
    document.getElementById('saveInvest').addEventListener('click',()=>{
      const d=document.getElementById('invDate').value||new Date().toISOString().slice(0,10)
      const type=document.getElementById('invType').value||'Other'
      const name=document.getElementById('invName').value||'-'
      const amt=Number(document.getElementById('invAmount').value)||0
      if(!amt) return alert('Enter amount')
      DATA.investments.push({date:d,type,name,amount:amt}); saveData(DATA); document.getElementById('investForm').style.display='none'; renderAll();
    })

    // Goals
    document.getElementById('addGoalBtn').addEventListener('click',()=>{document.getElementById('goalForm').style.display='block'})
    document.getElementById('saveGoal').addEventListener('click',()=>{
      const name=document.getElementById('goalName').value||'Goal'
      const target=Number(document.getElementById('goalTarget').value)||0
      const saved=Number(document.getElementById('goalSaved').value)||0
      if(!target) return alert('Enter target')
      DATA.goals.push({name,target,saved}); saveData(DATA); document.getElementById('goalForm').style.display='none'; renderAll();
    })

    // Export / Import
    document.getElementById('exportBtn').addEventListener('click',()=>{
      const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(DATA, null, 2)],{type:'application/json'})); a.download='pf-data.json'; a.click();
    })
    document.getElementById('importBtn').addEventListener('click',()=>document.getElementById('importFile').click())
    document.getElementById('importFile').addEventListener('change',async(e)=>{
      const f = e.target.files[0]; if(!f) return; const txt = await f.text(); try{ DATA = JSON.parse(txt); saveData(DATA); renderAll(); alert('Imported') }catch(err){alert('Invalid file')}
    })

    /* ---------- Rendering & calculations ---------- */
    function monthKey(dateStr){ const d=new Date(dateStr); return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}` }

    function renderAll(){ renderTransactions(); renderInvestments(); renderGoals(); renderDashboard(); renderMiniChart(); }

    function renderTransactions(){
      const tbody = document.getElementById('transTable'); tbody.innerHTML=''
      const month = Number(document.getElementById('transMonth').value||new Date().getMonth()+1)
      const year = Number(document.getElementById('transYear').value||new Date().getFullYear())
      const rows = DATA.transactions.filter(t=>{const d=new Date(t.date); return d.getMonth()+1===month && d.getFullYear()===year})
      rows.sort((a,b)=>new Date(b.date)-new Date(a.date))
      rows.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${r.date}</td><td>${r.type}</td><td>${r.category}</td><td>${r.description}</td><td class='right'>${r.amount.toLocaleString()}</td>`;tbody.appendChild(tr)})
    }

    function renderInvestments(){const tbody=document.getElementById('invTable');tbody.innerHTML=''; DATA.investments.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(i=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${i.date}</td><td>${i.type}</td><td>${i.name}</td><td class='right'>${i.amount.toLocaleString()}</td>`;tbody.appendChild(tr)})}

    function renderGoals(){const tbody=document.getElementById('goalTable');tbody.innerHTML=''; DATA.goals.forEach(g=>{const rem = Math.max(0,g.target - g.saved); const prog = Math.round((g.saved/g.target)*100*100)/100; const tr=document.createElement('tr'); tr.innerHTML=`<td>${g.name}</td><td class='right'>${g.target.toLocaleString()}</td><td class='right'>${g.saved.toLocaleString()}</td><td class='right'>${rem.toLocaleString()}</td><td class='right'>${isFinite(prog)?prog+'%':'0%'}</td>`; tbody.appendChild(tr)})
      // Fund table on dashboard
      const fundT=document.getElementById('fundTable'); fundT.innerHTML=''
      DATA.goals.forEach(g=>{const rem=Math.max(0,g.target-g.saved); const prog = Math.round((g.saved/g.target)*100*100)/100; const tr=document.createElement('tr'); tr.innerHTML=`<td>${g.name}</td><td class='right'>${g.target.toLocaleString()}</td><td class='right'>${g.saved.toLocaleString()}</td><td class='right'>${isFinite(prog)?prog+'%':'0%'}</td>`; fundT.appendChild(tr)})
    }

    function renderDashboard(){
      const year = Number(document.getElementById('yearSelect').value||new Date().getFullYear())
      const month = Number(document.getElementById('monthSelect').value||new Date().getMonth()+1)
      // totals for selected month
      let totInc=0, totExp=0, totSave=0
      DATA.transactions.forEach(t=>{const d=new Date(t.date); if(d.getFullYear()===year && d.getMonth()+1===month){ if(t.type.toLowerCase()==='income') totInc+=t.amount; else if(t.type.toLowerCase()==='expense') totExp+=t.amount; else totSave+=t.amount }})
      // investments in that month
      let totInv=0; DATA.investments.forEach(i=>{const d=new Date(i.date); if(d.getFullYear()===year && d.getMonth()+1===month) totInv+=i.amount})
      // write
      document.getElementById('totalIncome').textContent = totInc.toLocaleString()
      document.getElementById('totalExpense').textContent = totExp.toLocaleString()
      document.getElementById('netSavings').textContent = (totInc - totExp - totInv).toLocaleString()
      document.getElementById('totalInvest').textContent = totInv.toLocaleString()

      // YTD
      const ytdInc = DATA.transactions.filter(t=>new Date(t.date).getFullYear()===year && t.type.toLowerCase()==='income').reduce((s,x)=>s+x.amount,0)
      const ytdExp = DATA.transactions.filter(t=>new Date(t.date).getFullYear()===year && t.type.toLowerCase()==='expense').reduce((s,x)=>s+x.amount,0)
      const ytdSave = DATA.goals.reduce((s,g)=>s+g.saved,0)
      const ytdInv = DATA.investments.filter(i=>new Date(i.date).getFullYear()===year).reduce((s,x)=>s+x.amount,0)
      document.getElementById('ytdIncome').textContent = ytdInc.toLocaleString()
      document.getElementById('ytdExpense').textContent = ytdExp.toLocaleString()
      document.getElementById('ytdSaving').textContent = ytdSave.toLocaleString()
      document.getElementById('ytdInvest').textContent = ytdInv.toLocaleString()
      document.getElementById('carryForward').textContent = (ytdInc - ytdExp - ytdInv).toLocaleString()

      // Category pie
      try{ renderCategoryChart(year,month) }catch(e){}
    }

    function renderCategoryChart(year,month){
      const categories = {}
      DATA.transactions.forEach(t=>{const d=new Date(t.date); if(d.getFullYear()===year && d.getMonth()+1===month && t.type.toLowerCase()==='expense'){ categories[t.description] = (categories[t.description]||0)+t.amount }})
      const labels = Object.keys(categories); const values = labels.map(l=>categories[l])

      // ensure canvas exists and chart library loaded
      const canvas = document.getElementById('categoryChart')
      if(!canvas) return
      const ctx = canvas.getContext && canvas.getContext('2d')
      if(!ctx) return

      // If no data, show a placeholder slice so chart doesn't break
      const safeLabels = labels.length ? labels : ['No expenses']
      const safeValues = values.length ? values : [1]

      // If existing chart is present but malformed, destroy it and recreate
      if(window.categoryChart){
        try{
          if(window.categoryChart.data && Array.isArray(window.categoryChart.data.datasets) && window.categoryChart.data.datasets.length>0){
            window.categoryChart.data.labels = safeLabels
            window.categoryChart.data.datasets[0].data = safeValues
            window.categoryChart.update()
            return
          }
        }catch(err){
          try{ window.categoryChart.destroy() }catch(e){}
        }
        // fallback destroy if reached
        try{ window.categoryChart.destroy() }catch(e){}
        window.categoryChart = undefined
      }

      // create new pie chart
      try{
        window.categoryChart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: safeLabels,
            datasets: [{ data: safeValues }]
          },
          options: {
            plugins: { legend: { position: 'right', labels: { boxWidth: 12 } } }
          }
        })
      }catch(err){
        console.error('Failed to create category chart', err)
      }
    }

    function renderMiniChart(){
      // monthly income vs expense for selected year
      const year = Number(document.getElementById('yearSelect').value||new Date().getFullYear())
      const inc = new Array(12).fill(0); const exp = new Array(12).fill(0)
      DATA.transactions.forEach(t=>{const d=new Date(t.date); if(d.getFullYear()===year){ if(t.type.toLowerCase()==='income') inc[d.getMonth()] += t.amount; else if(t.type.toLowerCase()==='expense') exp[d.getMonth()] += t.amount }})
      const labels = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']

      const canvas = document.getElementById('miniChart')
      if(!canvas) return
      const ctx = canvas.getContext && canvas.getContext('2d')
      if(!ctx) return

      if(window.miniChart){
        try{
          if(window.miniChart.data && Array.isArray(window.miniChart.data.datasets) && window.miniChart.data.datasets.length>=2){
            window.miniChart.data.labels = labels
            window.miniChart.data.datasets[0].data = inc
            window.miniChart.data.datasets[1].data = exp
            window.miniChart.update()
            return
          }
        }catch(err){
          try{ window.miniChart.destroy() }catch(e){}
        }
        try{ window.miniChart.destroy() }catch(e){}
        window.miniChart = undefined
      }

      try{
        window.miniChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              { label: 'Income', data: inc },
              { label: 'Expense', data: exp }
            ]
          },
          options: { responsive: true, plugins: { legend: { display: true } } }
        })
      }catch(err){
        console.error('Failed to create mini chart', err)
      }
    }

    /* ---------- initial render and wiring selects ---------- */
    document.getElementById('yearSelect').addEventListener('change',renderAll)
    document.getElementById('monthSelect').addEventListener('change',renderAll)
    document.getElementById('transMonth').addEventListener('change',renderTransactions)
    document.getElementById('transYear').addEventListener('change',renderTransactions)

    // render after DOM fully ready to avoid timing issues with Chart.js
    window.addEventListener('DOMContentLoaded', ()=>{
      try{ renderAll() }catch(e){ console.error('renderAll error', e) }
    })
  </script>
</body>
</html>
